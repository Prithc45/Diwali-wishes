<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Diwali üéÜ</title>
  <style>
    :root {
      --bg1: #120417;
      --bg2: #2b0033;
      --accent: #f6b93b;
      --accent-2: #ff6b6b;
      --card: rgba(255, 255, 255, 0.04);
      --glass: rgba(255, 255, 255, 0.06);
      --text: #fff;
      --muted: rgba(255, 255, 255, 0.75);
      --gold: #ffd166;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Noto Sans", sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255, 200, 80, 0.06), transparent),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      color: var(--text);
    }

    .wrap {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 28px;
      box-sizing: border-box;
    }

    .card {
      width: 100%;
      max-width: 940px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      position: relative;
      overflow: hidden;
    }

    .topbar {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    h1 {
      margin: 0;
      font-size: 1.1rem;
      letter-spacing: 0.6px;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .hero {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      padding-top: 60px;
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--gold), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #2b0020;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
    }

    .gif-wrap {
      width: 100%;
      max-width: 498px;
      aspect-ratio: 1/1;
      margin: 0 auto;
      border-radius: 20px;
      overflow: hidden;
    }

    .gif-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .greeting {
      margin-top: 12px;
      text-align: center;
      padding: 10px;
    }

    .greet-stack {
      position: relative;
      height: 64px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .greet-text {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 1.05;
      white-space: nowrap;
    }

    .greet-text.hindi {
      font-family: "Noto Sans Devanagari", "Segoe UI", sans-serif;
    }

    .fade-in {
      opacity: 1;
      transition: opacity .6s ease
    }

    .fade-out {
      opacity: 0;
      transition: opacity .6s ease
    }

    .quote {
      margin-top: 8px;
      color: var(--muted);
      font-size: 0.98rem;
      text-align: center;
      padding: 0 18px;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .name-input {
      padding: 12px 14px;
      border-radius: 10px;
      border: none;
      background: var(--glass);
      color: var(--text);
      min-width: 210px;
      font-size: 1rem;
      outline: none;
      box-shadow: 3px 2px 9px rgba(255, 215, 0, 0.5);
      transition: box-shadow 0.25s ease;
    }

    .btn-whatsapp {
      background-color: #25D366;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      border-radius: 10px;
      padding: 10px 14px;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(37, 211, 102, 0.5);
      transition: transform .2s, box-shadow .2s;
    }

    .btn-whatsapp:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(37, 211, 102, 0.8);
    }

    .ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--muted);
    }

    .mantra {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 12px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
    }

    .mantra-title {
      font-weight: 600;
      font-size: 0.98rem;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .audio-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 12px;
      width: 100%;
      max-width: 540px;
    }

    .audio-player {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      max-width: 540px;
      padding: 8px 12px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255, 198, 60, 0.1), rgba(255, 90, 90, 0.1));
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      color: #fff;
      font-family: inherit;
    }

    .audio-player button {
      background: var(--accent);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      color: #2b0020;
      cursor: pointer;
      font-size: 1rem;
    }

    .audio-wrapper::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%) scaleX(var(--glow-scale, 1));
      width: 80%;
      height: 10px;
      border-radius: 20px;
      background: radial-gradient(circle, #FFD700, #FF4500, #FF69B4);
      opacity: var(--glow-opacity, 0.3);
      filter: blur(15px);
      transition: transform .05s ease, opacity .05s ease;
      pointer-events: none;
    }

    .progress-container {
      flex: 1;
      height: 6px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 6px;
      cursor: pointer;
      position: relative;
    }

    .progress {
      height: 100%;
      width: 0%;
      background: var(--gold);
      border-radius: 6px;
    }

    #time {
      font-size: 0.85rem;
      color: var(--muted);
      min-width: 75px;
      text-align: right;
    }

    .make {
      margin-top: 14px;
      color: var(--muted);
      font-size: 0.95rem;
      text-align: center;
    }

    .make a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 700;
    }

    @media (max-width:720px) {
      .flames {
        width: 300px;
        height: 140px
      }

      .greet-text {
        font-size: 1.05rem
      }

      .gif-wrap img {
        max-height: 320px
      }

      .name-input {
        min-width: 170px
      }
    }

    .lights {
      position: absolute;
      bottom: -120px;
      left: 0;
      right: 0;
      height: 160px;
      pointer-events: none;
      opacity: 0.6;
      background: radial-gradient(circle at 10% 40%, rgba(255, 198, 60, 0.12) 0 20%, transparent 21%), radial-gradient(circle at 90% 60%, rgba(255, 90, 90, 0.08) 0 15%, transparent 16%);
    }

    .sparkle {
      position: absolute;
      filter: blur(1px);
      opacity: 0.6;
    }

    .sparkle.s1 {
      top: 12%;
      left: 12%;
      width: 12px;
      height: 12px;
      background: radial-gradient(circle, #ffd166 0 40%, transparent 41%);
      animation: pop 3.6s linear infinite;
    }

    .sparkle.s2 {
      top: 8%;
      right: 9%;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #fff 0 40%, transparent 41%);
      animation: pop 4.6s linear infinite;
    }

    .btn-diwali {
      background: linear-gradient(135deg, #ffd700, #ff6b6b);
      color: #2b0020;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 200, 80, 0.5);
      transition: transform .2s, box-shadow .2s;
    }

    .btn-diwali:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 200, 80, 0.8);
    }

    #fireworkToggleBtn {
      background: var(--card);
      /* A dark background from your CSS */
      color: var(--text);
      border: 1px solid var(--accent);
      border-radius: 8px;
      /* Slightly rounded corners */
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      /* Spacing between icon and text */
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(255, 198, 60, 0.5);
      /* Subtle glow */
      transition: background 0.3s ease;
      /* Remove default button styles */
      font-family: inherit;
    }

    #fireworkToggleBtn:hover {
      background: var(--glass);
    }

    #fireworkToggleBtn img {
      width: 20px;
      height: 20px;
    }

    /* Keep this style but change the button's appearance */
    #fireworkToggleBtn {
      background-color: var(--accent);
      /* Yellow background for the button */
      border: none;
      border-radius: 8px;
      /* Slightly less rounded than the container */
      width: 48px;
      /* Slightly smaller than container to show container border */
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      /* Remove any default padding */
      transition: transform 0.2s ease;
      /* For a subtle hover effect */
    }

    #fireworkToggleBtn:hover {
      transform: scale(1.08);
      /* Slightly enlarge on hover */
    }

    #fireworkToggleBtn img {
      width: 24px;
      height: 24px;
      object-fit: contain;
      margin: 0;
      /* Remove any inherited margins */
    }

    /* Remove or modify existing #fireSoundBtn styles that conflict */
    #fireSoundBtn.glowing {
      box-shadow: 0 0 15px var(--gold), 0 0 25px var(--accent-2);
      /* More intense glow */
    }

    #fireSoundBtn.glowing:hover {
      box-shadow: 0 0 20px rgba(255, 200, 60, 1), 0 0 30px rgba(255, 90, 90, 0.7);
      transform: scale(1.05);
    }


    @keyframes pop {
      0% {
        transform: scale(.6);
        opacity: 0
      }

      40% {
        transform: scale(1.1);
        opacity: 1
      }

      100% {
        transform: scale(.6);
        opacity: 0
      }
    }
  </style>
</head>
<link rel="icon" type="image/x-icon" href="icon.png">

<body>
  <canvas id="fireworksCanvas"
    style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;"></canvas>
  <div class="wrap">
    <div class="card" id="mainCard">
      <div class="topbar">
        <div class="brand">
          <div class="logo" id="fireSoundBtn">
            <button id="fireworkToggleBtn">
              <img id="fireworkToggleIcon" src="volume.png" alt="Toggle Fireworks Sound" />
            </button>
          </div>
          <div>
            <h1>Diwali Wishes Make & Share</h1>
            <div class="subtitle">Create your own Diwali greeting</div>
          </div>
        </div>
        <div style="text-align:right;">
          <div style="font-weight:700;color:var(--gold)">Share joy ‚ú®</div>
          <div style="font-size:0.85rem;color:var(--muted)">Web page created by NICK</div>
        </div>
      </div>

      <div class="hero">
        <div class="gif-wrap" id="gifWrap"><img id="diwaliGif" alt="Diwali greeting GIF" src=""></div>

        <div class="greeting">
          <div class="greet-stack">
            <div id="greetEn" class="greet-text fade-in" aria-live="polite">Happy Diwali!</div>
            <div id="greetHi" class="greet-text greet-text hindi fade-out" aria-hidden="true">‡§¶‡•Ä‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï
              ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç!</div>
          </div>

          <div class="quote" id="quote">May your life be filled with light and joy.</div>

          <div class="actions" id="actionArea">
            <input id="nameInput" class="name-input" placeholder="Enter your name" />
            <button id="shareBtn" class="btn-whatsapp"><img src="whatsapp.png" alt="WhatsApp"
                style="width:18px;height:18px;">Share to WhatsApp</button>
            <button id="copyBtn" class="btn-diwali" title="Copy link">Copy Link</button>
          </div>

          <div class="mantra">
            <div class="mantra-title" id="mantraText">Listen to this mantra 5 times a day to invite Shree Lakshmi üí∏
            </div>
            <div class="audio-wrapper">
              <div class="audio-player">
                <button id="playBtn">‚ñ∂</button>
                <div class="progress-container">
                  <div class="progress" id="progressBar"></div>
                </div>
                <span id="time">0:00 / 4:24</span>
              </div>
            </div>
            <audio id="mantraAudio" src="Mantra.mp3" preload="auto"></audio>
          </div>

          <div class="make" id="makeLine">Make your own here by: <a href="#" id="makeLink">Entering your name &
              share</a></div>

          <!-- fireworks sound (file must be named exactly Fireworks.mp3) -->
          <audio id="fireworksAudio" src="Firework.mp3" preload="auto" loop></audio>

        </div>
      </div>

      <div class="lights"></div>
      <div class="sparkle s1"></div>
      <div class="sparkle s2"></div>
    </div>
  </div>

  <script>
    // --- Data & utils ---
    const gifs = ['Diwali_01.gif', 'Diwali_02.gif', 'Diwali_03.gif', 'Diwali_04.gif', 'Diwali_05.gif'];
    const quotes = [
      "May your life be filled with light and joy.",
      "Let this Diwali burn all your worries.",
      "Wishing you a Diwali full of sweet moments and memories to cherish.",
      "May the divine light of Diwali bring peace, prosperity, and happiness to your life.",
      "Light up your life with love and laughter this Diwali."
    ];
    function engGreeting(sender) { return sender ? `Happy Diwali wished from ${sender}!` : 'Happy Diwali!'; }
    function hindiGreeting(sender) { return sender ? `‡§¶‡•Ä‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ${sender} ‡§ï‡•Ä ‡§§‡§∞‡§´ ‡§∏‡•á!` : '‡§¶‡•Ä‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç!'; }
    function engShareLine(sender) { return sender ? `Open Happy Diwali üéÜ wishes from ${sender} üëá` : 'Open Happy Diwali üéÜ wishes üëá'; }
    function hindiShareLine(sender) { return sender ? `${sender} ‡§ï‡•Ä ‡§¶‡•Ä‡§µ‡§æ‡§≤‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ñ‡•ã‡§≤‡•á‡§Ç üëá` : '‡§¶‡•Ä‡§µ‡§æ‡§≤‡•Ä ‡§ï‡•Ä ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ñ‡•ã‡§≤‡•á‡§Ç üëá'; }
    function getParam(name) { return new URLSearchParams(window.location.search).get(name); }
    function buildShareUrl(fromName) { const base = window.location.origin + window.location.pathname; const params = new URLSearchParams(); if (fromName) params.set('from', fromName); return base + '?' + params.toString(); }
    function randomFrom(a) { return a[Math.floor(Math.random() * a.length)]; }

    // --- DOM refs ---
    const gifImg = document.getElementById('diwaliGif');
    const quoteEl = document.getElementById('quote');
    const nameInput = document.getElementById('nameInput');
    const shareBtn = document.getElementById('shareBtn');
    const copyBtn = document.getElementById('copyBtn');
    const makeLink = document.getElementById('makeLink');
    const greetEn = document.getElementById('greetEn');
    const greetHi = document.getElementById('greetHi');
    const mantraTitle = document.getElementById('mantraText');

    let currentFrom = getParam('from') || null;
    gifImg.src = randomFrom(gifs);
    gifImg.onerror = function () { gifImg.alt = "Diwali GIF not found"; gifImg.style.objectFit = 'contain'; gifImg.style.padding = '36px'; gifImg.src = ''; };
    quoteEl.textContent = randomFrom(quotes);

    // --- Greeting render ---
    function renderGreeting() {
      const sender = currentFrom;
      greetEn.textContent = engGreeting(sender);
      greetHi.textContent = hindiGreeting(sender);
      if (sender) { nameInput.value = ''; makeLink.style.display = 'block'; } else { nameInput.value = ''; makeLink.style.display = 'none'; }
    }
    renderGreeting();

    // --- bilingual swap ---
    let showingEnglish = true;
    function swapBilingualText() {
      if (showingEnglish) {
        greetEn.classList.remove('fade-out'); greetEn.classList.add('fade-in');
        greetHi.classList.remove('fade-in'); greetHi.classList.add('fade-out');
        mantraTitle.textContent = `Listen to this mantra 5 times a day to invite Shree Lakshmi üí∏`;
      } else {
        greetEn.classList.remove('fade-in'); greetEn.classList.add('fade-out');
        greetHi.classList.remove('fade-out'); greetHi.classList.add('fade-in');
        mantraTitle.textContent = `‡§∂‡•ç‡§∞‡•Ä ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§ï‡•ã ‡§ò‡§∞ ‡§¨‡•Å‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§¶‡§ø‡§® ‡§Æ‡•á‡§Ç 5 ‡§¨‡§æ‡§∞ ‡§∏‡•Å‡§®‡•á‡§Ç üí∏`;
      }
      showingEnglish = !showingEnglish;
    }
    swapBilingualText();
    setInterval(swapBilingualText, 5000);

    // --- Share handlers ---
    function handleShare() {
      const typed = nameInput.value.trim();
      const fromName = typed || currentFrom;
      if (!fromName) { alert("Please enter your name"); nameInput.focus(); return; }
      const link = buildShareUrl(fromName);
      const body = engShareLine(fromName) + "\n" + hindiShareLine(fromName) + "\n" + link;
      window.open('https://wa.me/?text=' + encodeURIComponent(body), '_blank');
    }
    function handleCopy() {
      const typed = nameInput.value.trim();
      const fromName = typed || currentFrom;
      if (!fromName) { alert("Please enter your name"); nameInput.focus(); return; }
      const link = buildShareUrl(fromName);
      navigator.clipboard?.writeText(link).then(() => { copyBtn.textContent = 'Copied!'; setTimeout(() => copyBtn.textContent = 'Copy Link', 1500); }).catch(() => { prompt('Copy this link:', link); });
    }
    shareBtn.addEventListener('click', handleShare);
    copyBtn.addEventListener('click', handleCopy);
    makeLink.addEventListener('click', e => { e.preventDefault(); nameInput.focus(); });
    nameInput.addEventListener('keydown', e => { if (e.key === 'Enter') handleShare(); });

    // --- Fireworks animation ---
    const canvas = document.getElementById('fireworksCanvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    let particles = [];
    const MAX_PARTICLES = 150;
    function rand(min, max) { return Math.random() * (max - min) + min; }

    // Particle class
    class Particle {
      constructor(x, y, color) {
        this.x = x; this.y = y;
        this.radius = rand(2, 4);
        this.color = color;
        const angle = rand(0, Math.PI * 2);
        const speed = rand(1, 2.5);
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.alpha = 1;
        this.decay = rand(0.01, 0.02);
        this.gravity = 0.08;
      }
      update() {
        this.vy += this.gravity; this.x += this.vx; this.y += this.vy; this.alpha -= this.decay;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(${this.color.r},${this.color.g},${this.color.b},${this.alpha})`;
        ctx.fill();
      }
    }

    function createFirework() {
      const x = rand(50, canvas.width - 50);
      const y = rand(50, canvas.height - 100);
      const palette = [
        { r: 255, g: 200, b: 50 },
        { r: 255, g: 90, b: 90 },
        { r: 255, g: 255, b: 255 },
        { r: 255, g: 150, b: 0 },
        { r: 200, g: 100, b: 255 }
      ];
      const color = palette[Math.floor(rand(0, palette.length))];
      const count = Math.floor(rand(18, 30));
      for (let i = 0; i < count; i++) if (particles.length < MAX_PARTICLES) particles.push(new Particle(x, y, color));
    }

    let fireworkInterval = null;
    function startFireworks() { if (!fireworkInterval) fireworkInterval = setInterval(createFirework, 500); }
    function stopFireworks() { if (fireworkInterval) { clearInterval(fireworkInterval); fireworkInterval = null; } }

    document.addEventListener('visibilitychange', () => {
      if (document.hidden) stopFireworks(); else startFireworks();
    });
    startFireworks();

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.update(); p.draw();
        if (p.alpha <= 0) particles.splice(i, 1);
      }
      requestAnimationFrame(animate);
    }
    animate();

    // --- Fireworks audio toggle ---
    const fireworkAudio = document.getElementById("fireworksAudio");
    const fireworkToggleBtn = document.getElementById("fireworkToggleBtn"); // Get the button itself
    const fireworkToggleIcon = document.getElementById("fireworkToggleIcon");
    const fireSoundBtnContainer = document.getElementById("fireSoundBtn"); // This is the .logo div

    let isFireworkPlaying = true;

    // Set initial state for the glow based on isFireworkPlaying
    if (isFireworkPlaying) {
      fireSoundBtnContainer.classList.add('glowing');
    } else {
      fireSoundBtnContainer.classList.remove('glowing');
    }


    if (fireworkAudio) {
      fireworkAudio.loop = true;
      // Attempt to play on load, but handle potential browser restrictions
      fireworkAudio.play().then(() => {
        fireSoundBtnContainer.classList.add('glowing'); // Ensure glowing if auto-played successfully
      }).catch(() => {
        // If autoplay blocked, set to paused state visually
        isFireworkPlaying = false;
        fireworkToggleIcon.src = "volume_off.png";
        fireSoundBtnContainer.classList.remove('glowing');
      });
    }


    fireworkToggleBtn.addEventListener("click", () => {
      if (!fireworkAudio) return; // Exit if audio element not found

      if (isFireworkPlaying) {
        fireworkAudio.pause();
        fireworkToggleIcon.src = "volume_off.png";
        fireSoundBtnContainer.classList.remove('glowing'); // Remove glow when off
      } else {
        fireworkAudio.play().catch(() => {
          // Handle play promise rejection (e.g., user interaction needed)
          console.log("Fireworks audio play blocked, user interaction needed.");
        });
        fireworkToggleIcon.src = "volume.png";
        fireSoundBtnContainer.classList.add('glowing'); // Add glow when on
      }
      isFireworkPlaying = !isFireworkPlaying; // Toggle the state
    });

    // Handle visibility changes (browser tab switching)
    document.addEventListener('visibilitychange', () => {
      if (!fireworkAudio) return;
      if (document.hidden) {
        fireworkAudio.pause();
      } else if (isFireworkPlaying) { // Only play if it was playing before hiding
        fireworkAudio.play().catch(() => { });
      }
    });

    // --- Mantra audio ---
    const audio = document.getElementById('mantraAudio');
    const playBtn = document.getElementById('playBtn');
    const progress = document.getElementById('progressBar');
    const timeText = document.getElementById('time');
    const audioWrapper = document.querySelector('.audio-wrapper');

    playBtn.addEventListener('click', () => {
      if (audio.paused) audio.play().then(() => playBtn.textContent = 'üïâÔ∏è').catch(() => console.log('mantra blocked'));
      else { audio.pause(); playBtn.textContent = '‚ñ∂'; }
    });

    audio.addEventListener('timeupdate', () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      progress.style.width = (isFinite(percent) ? percent : 0) + '%';
      const curM = Math.floor(audio.currentTime / 60), curS = Math.floor(audio.currentTime % 60).toString().padStart(2, '0');
      const durM = Math.floor((audio.duration || 0) / 60), durS = Math.floor((audio.duration || 0) % 60).toString().padStart(2, '0');
      if (!isNaN(durM)) timeText.textContent = `${curM}:${curS} / ${durM}:${durS}`;
    });

    document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        mantra.pause();
        mantra.currentTime = 0; // (optional) restart when reopened
    }
});


    document.querySelector('.progress-container').addEventListener('click', e => {
      if (!audio.duration) return;
      audio.currentTime = (e.offsetX / e.currentTarget.clientWidth) * audio.duration;
    });

    function animateGlow() {
      if (!audio.paused && audio.duration) {
        const beat = Math.abs(Math.sin(audio.currentTime * 3.5));
        audioWrapper.style.setProperty('--glow-scale', (0.9 + beat * 0.6).toString());
        audioWrapper.style.setProperty('--glow-opacity', (0.18 + beat * 0.45).toString());
      } else {
        audioWrapper.style.setProperty('--glow-scale', '1');
        audioWrapper.style.setProperty('--glow-opacity', '0.14');
      }
      requestAnimationFrame(animateGlow);
    }
    animateGlow();

    // --- Input glow ---
    const diwaliColors = ['#FFD700', '#FF6B6B', '#FF4500', '#FF1493', '#FFA500', '#ADFF2F', '#FF69B4'];
    if (nameInput) nameInput.addEventListener('input', () => {
      const color = diwaliColors[Math.floor(Math.random() * diwaliColors.length)];
      nameInput.style.boxShadow = `3px 4px 12px ${color}, 2px 3px 20px ${color}33`;
    });

    // --- Accessibility live announce ---
    const liveAnn = document.createElement('div');
    liveAnn.setAttribute('aria-live', 'polite');
    liveAnn.style.position = 'absolute'; liveAnn.style.left = '-9999px'; document.body.appendChild(liveAnn);
    setInterval(() => { liveAnn.textContent = showingEnglish ? greetEn.textContent : greetHi.textContent; }, 5000);
  </script>
  </script>
</body>
</html>